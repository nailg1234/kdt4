"""
============================================================
01. 선형 회귀 기초 (Linear Regression Basics)
============================================================

학습 목표:
1. 선형 회귀가 무엇인지
2. 왜 선형 회귀를 사용하는지
3. 직접 구현하는 방법
4. 라이브러리로 쉽게 사용하는 방법
5. 실전에서 어떻게 활용하는지
"""

import numpy as np
from sklearn.linear_model import LinearRegression
from sklearn.metrics import r2_score
import matplotlib.pyplot as plt

# 한글 폰트 설정
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

# ============================================================
# STEP 1: 선형 회귀란?
# ============================================================
# 질문: "공부를 1시간 더 하면 시험 점수가 몇 점 오를까?"
# 답: 선형 회귀로 알 수 있습니다!
#
# 선형 회귀 = 직선으로 데이터의 패턴을 찾는 방법
#
# 직선의 수식: y = wx + b
# - x: 입력값 (예: 공부 시간)
# - y: 출력값 (예: 시험 점수)
# - w: 기울기 (x가 1 증가하면 y가 w만큼 증가)
# - b: 절편 (x가 0일 때 y의 값)
#
# 실생활 예시:
# - 공부 시간 → 시험 점수
# - 집 면적 → 집 가격
# - 광고비 → 매출
# - 온도 → 아이스크림 판매량

# ============================================================
# STEP 2: 오차 측정 - 왜 제곱할까?
# ============================================================
# 문제: 오차 = 실제값 - 예측값
# - 어떤 예측은 +5 틀림
# - 어떤 예측은 -5 틀림
# - 평균: (+5) + (-5) = 0 (오차가 없는 것처럼 보임!)
#
# 해결: 오차를 제곱!
# - (+5)² = 25
# - (-5)² = 25
# - 평균: (25 + 25) / 2 = 25 (오차가 명확!)
#
# MSE (Mean Squared Error) = 평균 제곱 오차
# MSE가 작을수록 = 예측이 정확함

# ============================================================
# STEP 3: 최소제곱법으로 직접 계산하기
# ============================================================
# 목표: MSE가 가장 작은 w와 b 찾기
#
# 최소제곱법 공식:
# w = Σ(xi - x평균)(yi - y평균) / Σ(xi - x평균)²
# b = y평균 - w × x평균

print("=" * 60)
print("STEP 3: 최소제곱법으로 직접 계산")
print("=" * 60)

# 데이터 (공부 시간 vs 시험 점수)
공부시간 = np.array([1, 2, 3, 4, 5])
시험점수 = np.array([2, 4, 5, 4, 5])

print("\n[데이터]")
for i in range(len(공부시간)):
    print(f"  {공부시간[i]}시간 공부 → {시험점수[i]}점")

# 평균 계산
공부시간_평균 = np.mean(공부시간)
시험점수_평균 = np.mean(시험점수)

# 최소제곱법 공식 적용
분자 = np.sum((공부시간 - 공부시간_평균) * (시험점수 - 시험점수_평균))
분모 = np.sum((공부시간 - 공부시간_평균) ** 2)

w = 분자 / 분모  # 기울기
b = 시험점수_평균 - w * 공부시간_평균  # 절편

print(f"\n[결과]")
print(f"  기울기 (w): {w:.4f}")
print(f"  → 1시간 더 공부하면 {w:.2f}점 오름")
print(f"  절편 (b): {b:.4f}")
print(f"  → 공부 안해도 기본 {b:.2f}점")
print(f"  예측식: y = {w:.2f}x + {b:.2f}\n")

# ============================================================
# STEP 4: scikit-learn으로 쉽게 하기
# ============================================================
# 위 계산을 라이브러리가 자동으로 해줍니다!
# 핵심 코드 3줄:
# 1. model = LinearRegression()  # 모델 만들기
# 2. model.fit(X, y)             # 학습하기
# 3. model.predict(X)            # 예측하기

print("=" * 60)
print("STEP 4: scikit-learn 사용")
print("=" * 60)

# 데이터 준비 (scikit-learn은 2차원 배열 필요)
X = 공부시간.reshape(-1, 1)
y = 시험점수

# 3줄로 끝!
model = LinearRegression()
model.fit(X, y)
예측점수 = model.predict(X)

print(f"\n[결과]")
print(f"  기울기: {model.coef_[0]:.4f}")
print(f"  절편: {model.intercept_:.4f}")
print(f"  → 직접 계산한 것과 동일!\n")

# ============================================================
# STEP 5: 시각화
# ============================================================
# 그래프로 보면 더 명확!
# - 파란 점: 실제 데이터
# - 빨간 선: 예측 직선
# - 초록 점선: 오차

plt.figure(figsize=(10, 6))

plt.scatter(X, y, color='blue', s=100, label='실제 데이터', zorder=3)
plt.plot(X, 예측점수, color='red', linewidth=2, label='예측 직선', zorder=2)

# 오차 표시
for i in range(len(X)):
    plt.plot([X[i], X[i]], [y[i], 예측점수[i]], 'g--', alpha=0.5, zorder=1)

plt.xlabel('공부 시간 (시간)', fontsize=12)
plt.ylabel('시험 점수 (점)', fontsize=12)
plt.title('선형 회귀: 공부 시간 vs 시험 점수', fontsize=14, fontweight='bold')
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# ============================================================
# STEP 6: 실전 예제 - 광고비와 매출 예측
# ============================================================
# 상황: 온라인 쇼핑몰 운영자
# 질문: "광고비를 15백만원 쓰면 매출은?"

print("=" * 60)
print("STEP 6: 실전 예제 - 광고비로 매출 예측")
print("=" * 60)

# 과거 데이터
광고비 = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]).reshape(-1, 1)  # 백만원
매출 = np.array([3, 5, 6, 8, 11, 13, 14, 16, 17, 20])  # 천만원

# 모델 학습
model_광고 = LinearRegression()
model_광고.fit(광고비, 매출)

# 예측
새로운_광고비 = np.array([[15]])
예상_매출 = model_광고.predict(새로운_광고비)

print(f"\n[모델]")
print(f"  기울기: {model_광고.coef_[0]:.4f}")
print(f"  → 광고비 1백만원당 매출 {model_광고.coef_[0]:.2f}천만원 증가")
print(f"  절편: {model_광고.intercept_:.4f}")

print(f"\n[예측]")
print(f"  광고비 15백만원 → 예상 매출: {예상_매출[0]:.1f}천만원")

# 정확도 측정 (R² Score)
# R² = 1에 가까울수록 정확
# R² = 모델이 데이터의 몇 %를 설명하는지
매출_예측 = model_광고.predict(광고비)
r2 = r2_score(매출, 매출_예측)

print(f"\n[정확도]")
print(f"  R² Score: {r2:.4f}")
print(f"  → 모델이 데이터의 {r2*100:.1f}%를 설명")
if r2 > 0.9:
    print(f"  → 매우 정확")
elif r2 > 0.7:
    print(f"  → 괜찮음")
else:
    print(f"  → 개선 필요")

# ============================================================
# STEP 7: 머신러닝 → 비즈니스 언어 번역
# ============================================================
# 중요! 숫자만 말하면 아무도 모릅니다!
#
# ❌ 나쁜 예:
#    "R²가 0.81이고 MSE가 23입니다."
#    → 듣는 사람: "그래서 뭘 해야 하는데?"
#
# ✓ 좋은 예:
#    "광고비를 10% 늘리면 매출이 약 15% 증가할 것으로 예상됩니다.
#     현재 수익률을 고려하면 광고비 증액이 이익에 도움이 됩니다."
#
# 핵심 원칙:
# 1. 기술 용어 대신 → 퍼센트, 구체적 수치
# 2. 모델 성능 대신 → 무엇을 해야 하는지
# 3. 과거 분석 대신 → 미래 행동 가이드

print("\n" + "=" * 60)
print("요약")
print("=" * 60)
print("\n[오늘 배운 내용]")
print("  ✓ 선형 회귀 = 직선으로 패턴 찾기")
print("  ✓ MSE = 오차 측정 방법")
print("  ✓ 최소제곱법 = 최적의 직선 찾기")
print("  ✓ scikit-learn = 3줄로 끝")
print("  ✓ 실전 활용 = 비즈니스 언어로 번역")

print("\n[핵심 코드]")
print("  model = LinearRegression()")
print("  model.fit(X, y)")
print("  model.predict(X_new)")

print("\n[다음 단계]")
print("  → 02_경사하강법.py: 컴퓨터가 어떻게 최적의 직선을 찾는지")
print("  → 03_다중선형회귀.py: 여러 요인을 동시에 고려하기")

print("\n[연습 문제]")
print("  1. 당신의 데이터로 모델 만들어보기")
print("  2. R²가 0.5 미만이면? → 다른 모델 고려")
print("  3. 예측 결과를 1분 안에 설명할 수 있나요?")
print()
