<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>콜백 함수와 콜백 지옥</title>
  </head>
  <body>
    <script>
      // ============================================
      // 1. 콜백 함수(Callback Function)란?
      // ============================================
      // 콜백 함수: 다른 함수의 인자(매개변수)로 전달되는 함수
      // 비동기 작업이 완료된 후 실행할 코드를 지정하는 방법

      // 📌 기본 예제
      function doSomething(callback) {
        console.log("작업 시작");

        // 2초 후 비동기 작업 완료
        setTimeout(() => {
          console.log("작업 완료");
          callback(); // 전달받은 콜백 함수 실행
        }, 2000);
      }

      // doSomething 함수를 호출하면서 콜백 함수를 전달
      doSomething(() => {
        console.log("콜백 실행");
      });
      // 출력 순서:
      // "작업 시작" -> (2초 후) "작업 완료" -> "콜백 실행"

      // ============================================
      // 2. 실전 예제: 사용자 정보 가져오기
      // ============================================

      function fetchUser(userId, callback) {
        // 1단계: 서버에 사용자 정보 요청 시작
        console.log("사용자 정보 요청 중...");

        // 서버 응답을 기다리는 시간 시뮬레이션 (1초)
        setTimeout(() => {
          // 2단계: 서버로부터 받은 사용자 데이터 (실제로는 API 응답)
          const user = {
            id: userId,
            name: "홍길동",
          };

          // 3단계: 데이터를 받았으니 콜백 함수를 실행하여 결과 전달
          callback(user);
        }, 1000);
      }

      // fetchUser 함수 호출
      fetchUser(123, (user) => {
        // 4단계: 사용자 정보를 받아서 처리
        console.log("사용자 정보:", user);
      });
      // 실행 흐름:
      // "사용자 정보 요청 중..." -> (1초 대기) -> "사용자 정보: {id: 123, name: '홍길동'}"

      // ============================================
      // 3. 콜백 지옥(Callback Hell)
      // ============================================
      // 비동기 작업을 순차적으로 처리하기 위해 콜백을 중첩하면
      // 코드가 오른쪽으로 계속 깊어지는 피라미드 모양이 됩니다.
      // 이를 "콜백 지옥" 또는 "피라미드 오브 둠(Pyramid of Doom)"이라고 합니다.

      // 📌 콜백 지옥의 예시 (아래 코드는 예시용이므로 실행되지 않습니다)
      fetchUser(userId, (user) => {
        // 1단계: 사용자 정보를 가져온 후
        fetchPost(user.id, (posts) => {
          // 2단계: 해당 사용자의 게시글을 가져온 후
          fetchCommnet(user.id, (posts) => {
            // 3단계: 게시글의 댓글을 가져온 후
            fetchAuthor(user.id, (posts) => {
              // 4단계: 댓글 작성자 정보를 가져온 후
              fetchUser(user.id, (posts) => {
                // 5단계: 또 다른 작업...
                // 끝없는 중첩....
              });
            });
          });
        });
      });

      // ⚠️ 콜백 지옥의 문제점:
      // 1. 코드 가독성 저하
      //    - 코드가 오른쪽으로 깊어져서 읽기 매우 어려움
      //    - 어디서 시작하고 어디서 끝나는지 파악하기 힘듦
      //
      // 2. 에러 처리의 어려움
      //    - 각 단계마다 에러 처리를 해야 함
      //    - 어느 단계에서 에러가 발생했는지 파악하기 힘듦
      //    - 에러 처리 코드가 반복되어 코드가 더 복잡해짐
      //
      // 3. 유지보수의 어려움
      //    - 중간에 새로운 로직을 추가하거나 수정하기 복잡함
      //    - 코드 구조를 변경하기 매우 힘듦
      //
      // 💡 해결 방법:
      //    - Promise를 사용하여 체이닝 (.then())
      //    - async/await 문법 사용 (더 깔끔한 코드)
      //    - 이 내용은 다음 학습 자료에서 다룹니다!
    </script>
  </body>
</html>
