<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fetch API</title>
  </head>
  <body>
    <script>
      // ============================================
      // Fetch API
      // ============================================
      // ì„œë²„ì™€ HTTP í†µì‹ ì„ í•˜ê¸° ìœ„í•œ Web API
      // XMLHttpRequestì˜ í˜„ëŒ€ì ì¸ ëŒ€ì²´í’ˆ
      // Promise ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ë©° async/awaitì™€ í•¨ê»˜ ì‚¬ìš©í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤

      // ============================================
      // 1. Fetch API ê¸°ë³¸ ì‚¬ìš©ë²•
      // ============================================

      // ğŸ“Œ Promise ë°©ì‹
      // fetch("https://jsonplaceholder.typicode.com/users")
      //   .then((response) => {
      //     // response ê°ì²´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜
      //     return response.json();
      //   })
      //   .then((data) => {
      //     // ë³€í™˜ëœ ë°ì´í„° ì‚¬ìš©
      //     console.log("data", data);
      //   })
      //   .catch((error) => {
      //     // ì—ëŸ¬ ì²˜ë¦¬
      //     console.error("ì—ëŸ¬", error);
      //   });

      // ğŸ“Œ async/await ë°©ì‹ (ë” ê¹”ë”!)
      async function fetchData() {
        try {
          // 1ë‹¨ê³„: HTTP ìš”ì²­ ë³´ë‚´ê¸°
          const response = await fetch(
            "https://jsonplaceholder.typicode.com/users"
          );

          // 2ë‹¨ê³„: ì‘ë‹µ ìƒíƒœ í™•ì¸
          // HTTP ìƒíƒœ ì½”ë“œ (200: ì„±ê³µ, 404: ì°¾ì„ ìˆ˜ ì—†ìŒ, 500: ì„œë²„ ì—ëŸ¬ ë“±)
          console.log("ìƒíƒœ ì½”ë“œ:", response.status);

          // response ê°ì²´ì˜ ì£¼ìš” ì†ì„±:
          // - status: HTTP ìƒíƒœ ì½”ë“œ (200, 404 ë“±)
          // - ok: ì„±ê³µ ì—¬ë¶€ (200-299ë©´ true)
          // - headers: ì‘ë‹µ í—¤ë”
          // - url: ìš”ì²­í•œ URL

          // 3ë‹¨ê³„: ì‘ë‹µ ë³¸ë¬¸ íŒŒì‹±
          // ğŸ“Œ response ë©”ì„œë“œ:
          // - json(): JSON ë°ì´í„° íŒŒì‹± (API ë°ì´í„°ì— ì£¼ë¡œ ì‚¬ìš©)
          // - text(): í…ìŠ¤íŠ¸ë¡œ íŒŒì‹± (HTML, CSS ë“±)
          // - blob(): ë°”ì´ë„ˆë¦¬ ë°ì´í„° (ì´ë¯¸ì§€, íŒŒì¼ ë“±)
          // - arrayBuffer(): ì›ì‹œ ë°”ì´ë„ˆë¦¬ ë°ì´í„°
          const data = await response.json();
          console.log("ì‚¬ìš©ì ë°ì´í„°:", data);
        } catch (error) {
          // ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ë‚˜ íŒŒì‹± ì—ëŸ¬ ì²˜ë¦¬
          console.error("ì—ëŸ¬ ë°œìƒ:", error);
        }
      }

      fetchData();

      // ============================================
      // 2. HTTP ë©”ì„œë“œ
      // ============================================
      // GET: ë°ì´í„° ì¡°íšŒ
      // POST: ë°ì´í„° ìƒì„±
      // PUT/PATCH: ë°ì´í„° ìˆ˜ì •
      // DELETE: ë°ì´í„° ì‚­ì œ

      // ============================================
      // 3. GET ìš”ì²­ - ë°ì´í„° ì¡°íšŒ
      // ============================================

      // ğŸ“Œ ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ (ëª©ë¡)
      async function getUsers() {
        const response = await fetch(
          "https://jsonplaceholder.typicode.com/users"
        );
        const users = await response.json();
        console.log("ì „ì²´ ì‚¬ìš©ì:", users);
        return users;
      }

      // ğŸ“Œ ë‹¨ì¼ ì‚¬ìš©ì ì¡°íšŒ (íŠ¹ì • ID)
      async function getUser(id) {
        // í…œí”Œë¦¿ ë¦¬í„°ëŸ´ë¡œ ë™ì  URL ìƒì„±
        const response = await fetch(
          `https://jsonplaceholder.typicode.com/users/${id}`
        );
        const user = await response.json();
        console.log(`ì‚¬ìš©ì ${id}:`, user);
        return user;
      }

      // ì‚¬ìš© ì˜ˆì‹œ
      // getUser(1); // IDê°€ 1ì¸ ì‚¬ìš©ì ì¡°íšŒ

      // ============================================
      // 4. POST ìš”ì²­ - ë°ì´í„° ìƒì„±
      // ============================================
      // POST ìš”ì²­ ì‹œ fetchì˜ ë‘ ë²ˆì§¸ ì¸ìë¡œ ì˜µì…˜ ê°ì²´ ì „ë‹¬

      async function createPost(title, body) {
        const response = await fetch(
          "https://jsonplaceholder.typicode.com/posts",
          {
            // HTTP ë©”ì„œë“œ ì§€ì •
            method: "POST",

            // ìš”ì²­ í—¤ë” ì„¤ì •
            headers: {
              "Content-Type": "application/json", // JSON í˜•ì‹ì„ì„ ì•Œë¦¼
            },

            // ìš”ì²­ ë³¸ë¬¸ (body)
            // ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
            body: JSON.stringify({
              title: title,
              body: body,
              userId: 1,
            }),
          }
        );

        // ìƒì„±ëœ ê²Œì‹œê¸€ ë°ì´í„° ë°›ê¸°
        const newPost = await response.json();
        console.log("ìƒì„±ëœ ê²Œì‹œê¸€:", newPost);
        return newPost;
      }

      // ì‚¬ìš© ì˜ˆì‹œ
      createPost("ë‚˜ì˜ ì²« ê²Œì‹œê¸€", "ì•ˆë…•í•˜ì„¸ìš”! ì²« ê²Œì‹œê¸€ì…ë‹ˆë‹¤.");

      // ============================================
      // 5. ì—ëŸ¬ ì²˜ë¦¬ì™€ ìƒíƒœ í™•ì¸
      // ============================================

      async function fetchWithErrorHandling(url) {
        try {
          const response = await fetch(url);

          // HTTP ì—ëŸ¬ ì²´í¬ (404, 500 ë“±)
          if (!response.ok) {
            throw new Error(`HTTP ì—ëŸ¬! ìƒíƒœ: ${response.status}`);
          }

          const data = await response.json();
          return data;
        } catch (error) {
          // ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ë˜ëŠ” íŒŒì‹± ì—ëŸ¬
          console.error("ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:", error.message);
          throw error;
        }
      }

      // ì‚¬ìš© ì˜ˆì‹œ
      // fetchWithErrorHandling("https://jsonplaceholder.typicode.com/users");

      // ============================================
      // 6. ì‹¤ì „ ì˜ˆì œ: ë‹¤ì–‘í•œ ë°ì´í„° ì¡°íšŒ
      // ============================================

      // ğŸ“Œ ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ
      async function getPosts() {
        const response = await fetch(
          "https://jsonplaceholder.typicode.com/posts"
        );
        const posts = await response.json();
        console.log("ê²Œì‹œê¸€ ëª©ë¡:", posts);
        return posts;
      }

      getPosts();

      // ğŸ“Œ í•  ì¼ ëª©ë¡ ì¡°íšŒ
      async function getTodos() {
        const response = await fetch(
          "https://jsonplaceholder.typicode.com/todos"
        );
        const todos = await response.json();
        console.log("í•  ì¼ ëª©ë¡:", todos);
        return todos;
      }

      getTodos();

      // ============================================
      // 7. ì¶”ê°€ HTTP ë©”ì„œë“œ ì˜ˆì œ
      // ============================================

      // ğŸ“Œ PUT ìš”ì²­ - ì „ì²´ ë°ì´í„° ìˆ˜ì •
      async function updatePost(id, title, body) {
        const response = await fetch(
          `https://jsonplaceholder.typicode.com/posts/${id}`,
          {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              id: id,
              title: title,
              body: body,
              userId: 1,
            }),
          }
        );
        const updatedPost = await response.json();
        console.log("ìˆ˜ì •ëœ ê²Œì‹œê¸€:", updatedPost);
        return updatedPost;
      }

      // ğŸ“Œ PATCH ìš”ì²­ - ì¼ë¶€ ë°ì´í„°ë§Œ ìˆ˜ì •
      async function patchPost(id, updates) {
        const response = await fetch(
          `https://jsonplaceholder.typicode.com/posts/${id}`,
          {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(updates),
          }
        );
        const patchedPost = await response.json();
        console.log("ë¶€ë¶„ ìˆ˜ì •ëœ ê²Œì‹œê¸€:", patchedPost);
        return patchedPost;
      }

      // ğŸ“Œ DELETE ìš”ì²­ - ë°ì´í„° ì‚­ì œ
      async function deletePost(id) {
        const response = await fetch(
          `https://jsonplaceholder.typicode.com/posts/${id}`,
          {
            method: "DELETE",
          }
        );
        console.log("ì‚­ì œ ì™„ë£Œ:", response.status);
        return response.ok;
      }

      // ì‚¬ìš© ì˜ˆì‹œ
      // updatePost(1, "ìˆ˜ì •ëœ ì œëª©", "ìˆ˜ì •ëœ ë‚´ìš©");
      // patchPost(1, { title: "ì œëª©ë§Œ ìˆ˜ì •" });
      // deletePost(1);

      // ============================================
      // 8. Query Parameters ì‚¬ìš©
      // ============================================

      // URLì— ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì¶”ê°€í•˜ê¸°
      async function getPostsByUserId(userId) {
        // ë°©ë²• 1: ì§ì ‘ URLì— ì¶”ê°€
        const response = await fetch(
          `https://jsonplaceholder.typicode.com/posts?userId=${userId}`
        );
        const posts = await response.json();
        console.log(`ì‚¬ìš©ì ${userId}ì˜ ê²Œì‹œê¸€:`, posts);
        return posts;
      }

      // ë°©ë²• 2: URLSearchParams ì‚¬ìš© (ë” ê¹”ë”!)
      async function searchPosts(params) {
        const queryString = new URLSearchParams(params).toString();
        const response = await fetch(
          `https://jsonplaceholder.typicode.com/posts?${queryString}`
        );
        const posts = await response.json();
        return posts;
      }

      // ì‚¬ìš© ì˜ˆì‹œ
      // getPostsByUserId(1);
      // searchPosts({ userId: 1, _limit: 5 });

      // ============================================
      // 9. ì—¬ëŸ¬ ìš”ì²­ ë™ì‹œ ì²˜ë¦¬
      // ============================================

      async function getAllData() {
        try {
          // Promise.allë¡œ ì—¬ëŸ¬ ìš”ì²­ ë™ì‹œ ì‹¤í–‰
          const [users, posts, todos] = await Promise.all([
            fetch("https://jsonplaceholder.typicode.com/users").then((r) =>
              r.json()
            ),
            fetch("https://jsonplaceholder.typicode.com/posts").then((r) =>
              r.json()
            ),
            fetch("https://jsonplaceholder.typicode.com/todos").then((r) =>
              r.json()
            ),
          ]);

          console.log("ëª¨ë“  ë°ì´í„°:", { users, posts, todos });
          return { users, posts, todos };
        } catch (error) {
          console.error("ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:", error);
        }
      }

      // getAllData();

      // ğŸ’¡ Fetch API í•µì‹¬ ì •ë¦¬:
      // 1. fetch(url, options) - Promise ë°˜í™˜
      // 2. response.json() - JSON íŒŒì‹±
      // 3. method: GET(ê¸°ë³¸), POST, PUT, PATCH, DELETE
      // 4. headers: ìš”ì²­ í—¤ë” ì„¤ì •
      // 5. body: ìš”ì²­ ë³¸ë¬¸ (JSON.stringify í•„ìš”)
      // 6. async/awaitì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ì½”ë“œê°€ ê¹”ë”
      // 7. try...catchë¡œ ì—ëŸ¬ ì²˜ë¦¬ í•„ìˆ˜!

      // ğŸ’¡ JSONPlaceholder:
      // - í…ŒìŠ¤íŠ¸ìš© ê°€ì§œ REST API ì„œë²„
      // - ì‹¤ì œë¡œ ë°ì´í„°ê°€ ì €ì¥ë˜ì§€ëŠ” ì•ŠìŒ
      // - ì—°ìŠµìš©ìœ¼ë¡œ ì™„ë²½!
    </script>
  </body>
</html>
